---
layout: post
author: joonwan jeon
tags: [operating system]
category: operating system
---

# Program 실행

![](/assets/images/os/program_execution.png)

프로그램이 실행될 때 물리적인 메모리에 실행중인 프로그램 정보가 바로 올라가는 것이 아닌 **virtual memory** 라는 과정을 거칩니다. 프로그램의 모든 정보를 메모리에 올리는 것은 매우 비효율적이기 때문입니다.

특정 프로그램을 시작하면 해당 프로그램의 메모리 주소공간 (Address Space) 기 셍상됩니다. 이는 해당 프로그램만의 독자적이고 논리적인 메모리 주소공간입니다. 

이렇게 만들어진 주소공간의 모든 내용을 물리 메모리에 올리지 않습니다. 현재 프로그램 실행에 있어 당장 필요한 부분만 올립니다. 그리고 나머지 부분은 disk 의 swap area 라는 곳에 보관됩니다. 
이는 필요할 때 꺼내어 물리적 메모리에 올리고 현재 물리적 메모리에 있지만 당장 필요 없는 부분을 swap area 로 내보냅니다. 

> [!TIP]
> 참고로 address space 는 물리적인 메모리에 연속적으로 배치되지 않습니다.

> [!TIP]
> swap area 는 메모리 연장공간으로 사용되는 disk 의 일부입니다.

# Process

## Process 의 정의와 Process 의 문맥

### Process 란?

실행중인 프로그램을 의미합니다. 디스크에 있는 실행파일이 실행될 경우 메모리에 올라오는데 이 메모리에 올라와있는것을 바로 프로세스라고 합니다.

### Process 의 문맥

CPU 수행 상태를 나타내는 하드웨어 문맥을 의미합니다. 다음 하드웨어들을 통해 프로세스의 문맥을 확인할 수 있습니다.

- Program Counter : 다음번에 실행할 명령어의 주소가 저장되어 있는 register 입니다. 이때문에 명령어 pointer 라고도 불립니다.
- 그 외 register 들

### Process 의 주소공간 

크게 code, data, heap 그리고 stack 영역으로 구성되어 있습니다.
- code : program 의 소스 코드가 들어가는 영역입니다.
- data : 전역 변수 등 프로그램 실행을 위한 데이터가 들어가는 공간입니다.
- heap : 동적 할당 등에 의해 생성된 데이터가 들어가는 공간입니다.
- stack : 함수 호출에 대한 정보가 들어가는 공간입니다. 

### Process 관련 kernel 자료구조

운영체제는 이 process 를 관리하기 위해 특정한 자료구조를 사용하는데 바로 PCB 라는 자료구조 입니다. 
이는 Kernel 의 data 영역에서 관리되며 cpu 할당 관리 그리고 메모리 할당 관리하는 역할을 합니다.

PCB 는 process 를 관리하기 위해 반드시 필요한 자료구조입니다. 현대 컴퓨터는 time sharing 즉 시분할을 하며 여러 process 들을 실행합니다. 하드웨어들이 이 자료구주에 현재 process 의 문맥을 백업해두지 않을 경우 다음번에 해당 프로세스를 실행할 때 언제, 어떻게 실행해야 할 지 모릅니다. 따라서 이 프로세스의 문맥을 그대로 이어받아 프로세스를 싫행시키기 위해 반드시 PCB 로 현재 프로세스를 관리해야 합니다.

## Process 의 상태 

![](/assets/images/os/process_state.png)

프로세스의 상태는 크게 **다섯가지**로 나눌 수 있습니다.

### New
process 가 생성중인 상태를 의미합니다.

### Ready
cpu 를 할당받기 위해 ready queue 에서 대기하고 있는 상태를 의미합니다. 해당 프로세스들은 cpu 를 할당받으면 즉시 실행 가능한 상태입니다.

### Blocked (wait, sleep)
cpu 를 해당 프로세스에게 할당해도 당장 명령어를 실행할 수 없는 상태입니다. process 가 자신이 요청한 event 예를 들어 IO 작업이 완료되지 않아 이를 기다리는 상태입니다.

### Terminated
process 작업이 끝난 상태입니다. 프로세스 종료를 위해 정리하는 상태 입니다.

# PCB

<img src="/assets/images/os/pcb.png" width="250" height="500">

앞서 말했듯, PCB 는 kernel 이 process 를 관리하기 위해 프로세스당 유지하는 정보를 모아둔 구조체 입니다. 다음 요소들로 구성되어 있습니다.

**[kernel 이 관리상 사용하는 정보]**
- process 상태
- process id
- scheduling 정보
- 우선순위

**[cpu 수행 관련 하드웨어 값]**
- program counter
- registers 

**[메모리 관련]**
- code, data, stack 영역의 위치 정보

**[파일관련]**
- 열려있는 file descriptor 들 정보